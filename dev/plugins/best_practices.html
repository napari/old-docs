<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.06.18.beta36"/>
        <title>Best practices when developing napari plugins - napari</title>
      <link rel="stylesheet" href="../_static/styles/furo.css?digest=9b17055c4366e8b2949c66d6a9d8b0efe4dbaa60">
    <link rel="stylesheet" href="../_static/pygments.css">
    


<style>
  :root {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #002b36;
  --color-code-foreground: #839496;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../_static/pygments_dark.css">
    <link rel="stylesheet" href="../_static/styles/furo-extensions.css?digest=ee12cdd73c4bbac24afec78d92c4afd7c2d8ea7f">
    <script async defer data-domain="napari.org" src="https://plausible.io/js/plausible.js"></script>
    
</head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">napari</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">napari</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/3D_interactivity.html">3D interactivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/event_loop.html">An introduction to the event loop in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/connecting_events.html">Hooking up your own events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/events_reference.html">Events reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/threading.html">Multithreading in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/magicgui.html">Using <code class="docutils literal notranslate"><span class="pre">magicgui</span></code> in napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/perfmon.html">Performance monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/rendering.html">Asynchronous rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/preferences.html">Preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/translations.html">Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/contexts_expressions.html">Contexts and Expressions in napari</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index.html">Plugins</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="find-and-install-plugin.html">Finding and installing a napari plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="for_napari_developers.html">napari plugin architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="for_plugin_developers.html">Creating a napari plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="hook_specifications.html">napari hook specification reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developers/index.html">Developer resources</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers/team.html">About the project and team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/code_of_conduct_reporting.html">Handling Code of Conduct reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/contributing.html">Contributing guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/core_dev_guide.html">Core Developer guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/docs.html">Organization of Documentation for napari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/governance.html">Governance model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/mission_and_values.html">Mission and Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/working_groups.html">Working groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/release.html">Release guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/roadmap_0_3.html">Roadmap 0.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/roadmap_0_3_retrospective.html">Roadmap 0.3 Retrospective</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/roadmap_0_4.html">Roadmap 0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/testing.html">Testing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations/index.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/docker.html">Napari in Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/performance.html">Napari performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/rendering.html">Rendering in napari</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../release/index.html">Release notes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_11.html">napari 0.4.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_10.html">napari 0.4.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_9.html">napari 0.4.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_8.html">napari 0.4.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_7.html">napari 0.4.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_6.html">napari 0.4.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_5.html">napari 0.4.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_4.html">napari 0.4.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_3.html">napari 0.4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_2.html">napari 0.4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_1.html">napari 0.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_4_0.html">napari 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_8.html">napari 0.3.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_7.html">napari 0.3.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_6.html">napari 0.3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_5.html">napari 0.3.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_4.html">napari 0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_3.html">napari 0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_2.html">napari 0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_1.html">napari 0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_3_0.html">napari 0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_12.html">napari 0.2.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_11.html">napari 0.2.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_10.html">napari 0.2.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_9.html">napari 0.2.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_8.html">napari 0.2.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_7.html">napari 0.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_6.html">napari 0.2.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_5.html">napari 0.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_4.html">napari 0.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_3.html">napari 0.2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_1.html">napari 0.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_2_0.html">napari 0.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_1_5.html">napari 0.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_1_3.html">napari 0.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/release_0_1_0.html">napari 0.1.0</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.layers.html">napari.layers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Image.html">napari.layers.Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Labels.html">napari.layers.Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Layer.html">napari.layers.Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Points.html">napari.layers.Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Shapes.html">napari.layers.Shapes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Surface.html">napari.layers.Surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Tracks.html">napari.layers.Tracks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.layers.Vectors.html">napari.layers.Vectors</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.view_layers.html">napari.view_layers</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.view_layers.Viewer.html">napari.view_layers.Viewer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.types.html">napari.types</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.ArrayBase.html">napari.types.ArrayBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.Path.html">napari.types.Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.SampleDict.html">napari.types.SampleDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.TracebackType.html">napari.types.TracebackType</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.TypedDict.html">napari.types.TypedDict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.types.partial.html">napari.types.partial</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.utils.html">napari.utils</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.utils.Colormap.html">napari.utils.Colormap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.utils.nbscreenshot.html">napari.utils.nbscreenshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.utils.progress.html">napari.utils.progress</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.plugins.html">napari.plugins</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.plugins.NapariPluginManager.html">napari.plugins.NapariPluginManager</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.components.html">napari.components</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.components.Camera.html">napari.components.Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.components.Dims.html">napari.components.Dims</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.components.LayerList.html">napari.components.LayerList</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.components.ViewerModel.html">napari.components.ViewerModel</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.qt.threading.html">napari.qt.threading</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label for="toctree-checkbox-13"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.qt.threading.FunctionWorker.html">napari.qt.threading.FunctionWorker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.qt.threading.GeneratorWorker.html">napari.qt.threading.GeneratorWorker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.qt.threading.GeneratorWorkerSignals.html">napari.qt.threading.GeneratorWorkerSignals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.qt.threading.WorkerBase.html">napari.qt.threading.WorkerBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.qt.threading.WorkerBaseSignals.html">napari.qt.threading.WorkerBaseSignals</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.utils.perf.html">napari.utils.perf</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label for="toctree-checkbox-14"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.utils.perf.PerfEvent.html">napari.utils.perf.PerfEvent</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/napari.html">napari</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label for="toctree-checkbox-15"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/napari.Viewer.html">napari.Viewer</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="best-practices-when-developing-napari-plugins">
<h1>Best practices when developing napari plugins<a class="headerlink" href="#best-practices-when-developing-napari-plugins" title="Permalink to this headline">¶</a></h1>
<p>There are a number of good and bad practices that may not be immediately obvious
when developing a plugin.  This page covers some known practices that could
affect the ability to install or use your plugin effectively.</p>
<div class="section" id="don-t-include-pyside2-or-pyqt5-in-your-plugin-s-dependencies">
<h2>Don’t include <code class="docutils literal notranslate"><span class="pre">PySide2</span></code> or <code class="docutils literal notranslate"><span class="pre">PyQt5</span></code> in your plugin’s dependencies.<a class="headerlink" href="#don-t-include-pyside2-or-pyqt5-in-your-plugin-s-dependencies" title="Permalink to this headline">¶</a></h2>
<p><em>This is important!</em></p>
<p>Napari supports <em>both</em> PyQt and PySide backends for Qt.  It is up to the
end-user to choose which one they want. If they installed napari with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">napari[all]</span></code>, then the <code class="docutils literal notranslate"><span class="pre">[all]</span></code> extra will (currently) install <code class="docutils literal notranslate"><span class="pre">PyQt5</span></code>
for them from pypi.  If they installed via <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">napari</span></code>, then they’ll
have <code class="docutils literal notranslate"><span class="pre">PyQt5</span></code>, but via anaconda cloud instead of pypi. Lastly, they may have
installed napari with PySide2.</p>
<p>Here’s what can go wrong if you <em>also</em> declare one of these backends in the
<code class="docutils literal notranslate"><span class="pre">install_requires</span></code> section of your plugin metadata:</p>
<ul>
<li><p>If they installed via <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">napari</span></code> and then they install your plugin
via <code class="docutils literal notranslate"><span class="pre">pip</span></code> (or via the builtin plugin installer, which currently uses <code class="docutils literal notranslate"><span class="pre">pip</span></code>),
then there <em>will</em> be a binary incompatibility between the their conda <code class="docutils literal notranslate"><span class="pre">pyqt</span></code>
installation, and the new pip “<code class="docutils literal notranslate"><span class="pre">PyQt5</span></code>” installation. <em>This will very likely
lead to a broken environment, forcing the user to re-create their entire
environment and re-install napari</em>. This is an unfortunate consequence of
<a class="reference external" href="https://github.com/ContinuumIO/anaconda-issues/issues/1554">package naming
decisions</a>, and
it’s not something napari can fix.</p></li>
<li><p>Alternatively, they may end up with <em>both</em> PyQt and PySide in their
environment, and while that’s not always guaranteed to break things, it can
lead to unexpected and difficult to debug problems.</p></li>
<li><p><strong>Don’t import from PyQt5 or PySide2 in your plugin: use <code class="docutils literal notranslate"><span class="pre">qtpy</span></code>.</strong></p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">PyQt5</span> <span class="pre">import</span> <span class="pre">QtCore</span></code> (or similar) in your plugin, but the
end-user has chosen to use <code class="docutils literal notranslate"><span class="pre">PySide2</span></code> for their Qt backend — or vice versa —
then your plugin will fail to import.  Instead use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">qtpy</span> <span class="pre">import</span>   <span class="pre">QtCore</span></code>.  <code class="docutils literal notranslate"><span class="pre">qtpy</span></code> is a <a class="reference external" href="https://github.com/spyder-ide/qtpy">Qt compatibility
layer</a> that will import from whatever
backend is installed in the environment.</p>
</li>
</ul>
</div>
<div class="section" id="try-not-to-depend-on-packages-that-require-c-compilation-but-do-not-offer-wheels">
<h2>Try not to depend on packages that require C compilation, but do not offer “wheels”<a class="headerlink" href="#try-not-to-depend-on-packages-that-require-c-compilation-but-do-not-offer-wheels" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This requires some awareness of how your dependencies are built and distributed…</p>
<p>Some python packages write a portion of their code in lower level languages like
C or C++ and compile that code into “C Extensions” that can be called by python
at runtime.  This can <em>greatly</em> improve performance, but it means that the
package must be compiled for <em>each</em> platform (i.e. Windows, Mac, Linux) that the
package wants to support.  Some packages do this compilation step ahead of time,
by distributing “<a class="reference external" href="https://realpython.com/python-wheels/">wheels</a>” on
<a class="reference external" href="https://pypi.org/">PyPI</a>… or by providing pre-compiled packages via <code class="docutils literal notranslate"><span class="pre">conda</span></code>.
Other packages simply distribute the source code (as an “sdist”) and expect the
end-user to compile it on their own computer.  Compiling C code requires
software that is not always installed on every computer. (If you’ve ever tried
to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> a package and had it fail with a big wall of red text saying
something about <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, then you’ve run into a package that doesn’t distribute
wheels, and you didn’t have the software required to compile it).</p>
</div>
<p>As a plugin developer, if you depend on a package that uses C extensions but
doesn’t distribute a pre-compiled wheel, then it’s very likely that your users
will run into difficulties installing your plugin:</p>
<ul>
<li><p><em>What is a “wheel”?</em></p>
<p>Briefly, a wheel is a <em>built distribution</em>, containing code that is
pre-compiled for a specific operating system.</p>
<p>For more detail, see <a class="reference external" href="https://realpython.com/python-wheels/">What Are Python Wheels and Why Should You
Care?</a></p>
</li>
<li><p><em>How do I know if my dependency offers a wheel</em></p>
<p>There are many ways, but a sure-fire way to know is to go to the respective
package on PyPI, and click on the “Download Files” link.  If the package
offers wheels, you’ll see one or more files ending in <code class="docutils literal notranslate"><span class="pre">.whl</span></code>.  For example,
<a class="reference external" href="https://pypi.org/project/napari/#files">napari offers a wheel</a>.  If a package
<em>doesn’t</em> offer a wheel, it may still be ok if it’s just a pure python package
that doesn’t have any C extensions…</p>
</li>
<li><p><em>How do I know if one of my dependencies uses C Extensions?</em></p>
<p>There’s no one right way, but more often than not, if a package uses C
extensions, the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function in their <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file will use the
<a class="reference external" href="https://docs.python.org/3/distutils/setupscript.html#describing-extension-modules"><code class="docutils literal notranslate"><span class="pre">ext_modules</span></code>
argument</a>.
(for example, <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/setup.py#L914">see here in
pytorch</a>)</p>
</li>
</ul>
<div class="admonition-what-about-conda admonition">
<p class="admonition-title">What about conda?</p>
<p><strong>conda</strong> also distributes &amp; installs pre-compiled packages, though they aren’t
wheels.  While this definitely a fine way to install binary dependencies in a
reliable way, the built-in napari plugin installer doesn’t currently work with
conda.  If your dependency is only available on conda, but does not offer
wheels,you <em>may</em> guide your users in using conda to install your package or one
of your dependencies.  Just know that it may not work with the built-in plugin
installer.</p>
</div>
</div>
<div class="section" id="don-t-import-heavy-dependencies-at-the-top-of-your-module">
<h2>Don’t import heavy dependencies at the top of your module<a class="headerlink" href="#don-t-import-heavy-dependencies-at-the-top-of-your-module" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This point will be less relevant when we move to the second generation
<a class="reference external" href="https://github.com/napari/napari/issues/3115">manifest-based plugin
declaration</a>, but it’s still a
good idea to delay importing your plugin-specific dependencies and modules until
<em>after</em> your hookspec has been called.  This helps napari stay quick and
responsive at startup.</p>
</div>
<p>Consider the following example plugin:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[options.entry_points]</span>
<span class="na">napari.plugion</span> <span class="o">=</span>
  <span class="na">plugin-name</span> <span class="o">=</span> <span class="s">mypackage.napari_plugin</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">my_heavy_dependency_like_tensorflow</span></code> will be imported
<em>immediately</em> when napari is launched, and we search the entry_point
<code class="docutils literal notranslate"><span class="pre">mypackage.napari_plugin</span></code> for decorated hook specifications.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypackage/napari_plugin.py</span>
<span class="kn">from</span> <span class="nn">napari_plugin_engine</span> <span class="kn">import</span> <span class="n">napari_hook_specification</span>
<span class="kn">from</span> <span class="nn">qtpy.QtWidgets</span> <span class="kn">import</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">my_heavy_dependency_like_tensorflow</span> <span class="kn">import</span> <span class="n">something_amazing</span>

<span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_something_amazing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">something_amazing</span><span class="p">()</span>

<span class="nd">@napari_hook_specification</span>
<span class="k">def</span> <span class="nf">napari_experimental_provide_dock_widget</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">MyWidget</span>
</pre></div>
</div>
<p>This can deterioate the end-user experience, and make napari feel slugish. Best
practice is to delay heavy imports until right before they are used.  The
following slight modification will help napari load much faster:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypackage/napari_plugin.py</span>
<span class="kn">from</span> <span class="nn">napari_plugin_engine</span> <span class="kn">import</span> <span class="n">napari_hook_specification</span>
<span class="kn">from</span> <span class="nn">qtpy.QtWidgets</span> <span class="kn">import</span> <span class="n">QWidget</span>

<span class="k">class</span> <span class="nc">MyWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_something_amazing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># import has been moved here, will happen only after the user</span>
        <span class="c1"># has opened and used this widget.</span>
        <span class="kn">from</span> <span class="nn">my_heavy_dependency_like_tensorflow</span> <span class="kn">import</span> <span class="n">something_amazing</span>

        <span class="k">return</span> <span class="n">something_amazing</span><span class="p">()</span>
</pre></div>
</div>
<p>(again, the second gen napari plugin engine will help improve this situation,
but it’s still a good idea!)</p>
</div>
<div class="section" id="don-t-leave-resources-open">
<h2>Don’t leave resources open<a class="headerlink" href="#don-t-leave-resources-open" title="Permalink to this headline">¶</a></h2>
<p>It’s always good practice to clean up resources like open file handles and
databases.  As a napari plugin it’s particularly important to do this (and
especially for Windows users).  If someone tries to use the built-in plugin
manager to <em>uninstall</em> your plugin, open file handles and resources may cause
the process to fail or even leave your plugin in an “installed-but-unuseable”
state.</p>
<p>Don’t do this:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_plugin/module.py</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">data_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"some_data_in_my_plugin.json"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead, make sure to close your resource after grabbing the data (ideally by
using a context manager, but manually otherwise):</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"some_data_in_my_plugin.json"</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-extensive-tests-for-your-plugin">
<h2>Write extensive tests for your plugin!<a class="headerlink" href="#write-extensive-tests-for-your-plugin" title="Permalink to this headline">¶</a></h2>
<p>Programmer and author Bruce Eckel famously wrote:</p>
<blockquote>
<div><p>“If it’s not tested, it’s broken”</p>
</div></blockquote>
<p>It’s true.  High test coverage is one way to show your users that you are
dedicated to the stability of your plugin. Aim for 100%!</p>
<p>Of course, simply having 100% coverage doesn’t mean your code is bug-free, so
make sure that you test all of the various ways that your code might be called.</p>
<div class="section" id="tips-for-testing-napari-plugins">
<h3>Tips for testing napari plugins<a class="headerlink" href="#tips-for-testing-napari-plugins" title="Permalink to this headline">¶</a></h3>
<p>The most common issue people run into when designing tests for napari plugins is
that they try to test everything as a full “integration test”, starting from the
napari event or action that would trigger their plugin to do something.  For
example, let’s say you have a dock widget that connects a mouse callback to the
viewer:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">:</span> <span class="s1">'napari.Viewer'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>

        <span class="nd">@viewer</span><span class="o">.</span><span class="n">mouse_move_callbacks</span><span class="o">.</span><span class="n">append</span>
        <span class="k">def</span> <span class="nf">_on_mouse_move</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">'Shift'</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="o">...</span>

<span class="nd">@napari_hook_implementation</span>
<span class="k">def</span> <span class="nf">napari_experimental_provide_dock_widget</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">MyWidget</span>
</pre></div>
</div>
<p>You might think that you need to somehow simulate a mouse movement in napari in
order to test this, but you don’t! Just <em>trust</em> that napari will call this
function with a <code class="docutils literal notranslate"><span class="pre">Viewer</span></code> and an <code class="docutils literal notranslate"><span class="pre">Event</span></code> when a mouse move has been made, and
otherwise leave <code class="docutils literal notranslate"><span class="pre">napari</span></code> out of it.</p>
<p>Instead, focus on “unit testing” your code: just call the function directly with
objects that emulate, or “mock” the objects that your function expects to
receive from napari. You may also need to slightly reorganize your code.  Let’s
modify the above widget to make it easier to test:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyWidget</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">:</span> <span class="s1">'napari.Viewer'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="c1"># connecting to a method rather than a local function</span>
        <span class="c1"># makes it easier to test</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">mouse_move_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_mouse_move</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">'Shift'</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>To test this, we can often just instantiate the widget with our own viewer, and
then call the methods directly. As for the <code class="docutils literal notranslate"><span class="pre">event</span></code> object, notice that all we
care about in this plugin is that it has a <code class="docutils literal notranslate"><span class="pre">modifiers</span></code> attribute that may or may
contain the string <code class="docutils literal notranslate"><span class="pre">"Shift"</span></code>.  So let’s just fake it!</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FakeEvent</span><span class="p">:</span>
    <span class="n">modifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Shift'</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_mouse_callback</span><span class="p">(</span><span class="n">make_napari_viewer</span><span class="p">):</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">make_napari_viewer</span><span class="p">()</span>
    <span class="n">wdg</span> <span class="o">=</span> <span class="n">MyWidget</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span>
    <span class="n">wdg</span><span class="o">.</span><span class="n">_on_mouse_move</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">FakeEvent</span><span class="p">())</span>
    <span class="c1"># assert that what you expect to happen actually happened!</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-check-test-coverage">
<h3>How to check test coverage?<a class="headerlink" href="#how-to-check-test-coverage" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/napari/cookiecutter-napari-plugin">cookiecutter
template</a> is already set
up to report test coverage, but you can test locally as well, using
<a class="reference external" href="https://github.com/pytest-dev/pytest-cov">pytest-cov</a></p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pytest-cov</span></code></p></li>
<li><p>Run your tests with <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--cov=&lt;your_package&gt;</span> <span class="pre">--cov-report=html</span></code></p></li>
<li><p>Open the resulting report in your browser: <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">htmlcov/index.html</span></code></p></li>
<li><p>The report will show line-by-line what is being tested, and what is being
missed. Continue writing tests until everything is covered!. If you have
lines that you <em>know</em> never need to be tested (like debugging code) you can
<a class="reference external" href="https://coverage.readthedocs.io/en/coverage-4.3.3/excluding.html#excluding-code-from-coverage-py">exempt specific
lines</a>
from coverage with the comment <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">cover</span></code></p></li>
<li><p>In the cookiecutter, coverage tests from github actions will be uploaded to
<a class="reference external" href="http://codecov.io">codecov.io</a></p></li>
</ol>
</div>
</div>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./plugins"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
      </article>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2020
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../_sources/plugins/best_practices.md"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Best practices when developing napari plugins</a><ul>
<li><a class="reference internal" href="#don-t-include-pyside2-or-pyqt5-in-your-plugin-s-dependencies">Don’t include <code class="docutils literal notranslate"><span class="pre">PySide2</span></code> or <code class="docutils literal notranslate"><span class="pre">PyQt5</span></code> in your plugin’s dependencies.</a></li>
<li><a class="reference internal" href="#try-not-to-depend-on-packages-that-require-c-compilation-but-do-not-offer-wheels">Try not to depend on packages that require C compilation, but do not offer “wheels”</a></li>
<li><a class="reference internal" href="#don-t-import-heavy-dependencies-at-the-top-of-your-module">Don’t import heavy dependencies at the top of your module</a></li>
<li><a class="reference internal" href="#don-t-leave-resources-open">Don’t leave resources open</a></li>
<li><a class="reference internal" href="#write-extensive-tests-for-your-plugin">Write extensive tests for your plugin!</a><ul>
<li><a class="reference internal" href="#tips-for-testing-napari-plugins">Tips for testing napari plugins</a></li>
<li><a class="reference internal" href="#how-to-check-test-coverage">How to check test coverage?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>