

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>napari.utils.colormaps.colormap_utils &mdash; napari 0.4.0rc1.dev2+gb576203 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <script async defer data-domain="napari.org" src="https://plausible.io/js/plausible.js"></script>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> napari
          

          
            
            <img src="../../../../_static/napari_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.4.0rc1.dev2+gb576203
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../events/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developers/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../explanations/index.html">Explanations</a></li>
<li class="toctree-l1"><a class="reference external" href="https://napari.org">Home</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/napari/napari">Source Code</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">napari</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>napari.utils.colormaps.colormap_utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for napari.utils.colormaps.colormap_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">vispy.color</span> <span class="kn">import</span> <span class="n">BaseColormap</span> <span class="k">as</span> <span class="n">VispyColormap</span>
<span class="kn">from</span> <span class="nn">vispy.color</span> <span class="kn">import</span> <span class="n">get_colormap</span><span class="p">,</span> <span class="n">get_colormaps</span>

<span class="kn">from</span> <span class="nn">.bop_colors</span> <span class="kn">import</span> <span class="n">bopd</span>
<span class="kn">from</span> <span class="nn">.colormap</span> <span class="kn">import</span> <span class="n">Colormap</span>
<span class="kn">from</span> <span class="nn">.vendored</span> <span class="kn">import</span> <span class="n">cm</span><span class="p">,</span> <span class="n">colorconv</span>

<span class="n">_matplotlib_list_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;matplotlib_cmaps.txt&#39;</span>
<span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_matplotlib_list_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">matplotlib_colormaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">]</span>


<span class="n">ValidColormapArg</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="n">VispyColormap</span><span class="p">,</span>
    <span class="n">Colormap</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">],</span>
    <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">],</span>
    <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">],</span>
    <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">],</span>
    <span class="n">Dict</span><span class="p">,</span>
<span class="p">]</span>


<span class="n">primary_color_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
<span class="n">primary_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">SIMPLE_COLORMAPS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Colormap</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">color</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">primary_color_names</span><span class="p">,</span> <span class="n">primary_colors</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># dictionay for bop colormap objects</span>
<span class="n">BOP_COLORMAPS</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">Colormap</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bopd</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="k">def</span> <span class="nf">_all_rgb</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return all 256**3 valid rgb tuples.&quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>


<span class="c1"># obtained with colorconv.rgb2luv(_all_rgb().reshape((-1, 256, 3)))</span>
<span class="n">LUVMIN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">83.07790815</span><span class="p">,</span> <span class="o">-</span><span class="mf">134.09790293</span><span class="p">])</span>
<span class="n">LUVMAX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">175.01447356</span><span class="p">,</span> <span class="mf">107.39905336</span><span class="p">])</span>
<span class="n">LUVRNG</span> <span class="o">=</span> <span class="n">LUVMAX</span> <span class="o">-</span> <span class="n">LUVMIN</span>

<span class="c1"># obtained with colorconv.rgb2lab(_all_rgb().reshape((-1, 256, 3)))</span>
<span class="n">LABMIN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">86.18302974</span><span class="p">,</span> <span class="o">-</span><span class="mf">107.85730021</span><span class="p">])</span>
<span class="n">LABMAX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">98.23305386</span><span class="p">,</span> <span class="mf">94.47812228</span><span class="p">])</span>
<span class="n">LABRNG</span> <span class="o">=</span> <span class="n">LABMAX</span> <span class="o">-</span> <span class="n">LABMIN</span>


<div class="viewcode-block" id="convert_vispy_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.convert_vispy_colormap">[docs]</a><span class="k">def</span> <span class="nf">convert_vispy_colormap</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vispy&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a vispy colormap object to a napari colormap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    colormap : vispy.color.Colormap</span>
<span class="sd">        Vispy colormap object that should be converted.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of colormap, optional.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    napari.utils.Colormap</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;Colormap must be a vispy colormap &#39;</span> <span class="s1">&#39;if passed to from_vispy&#39;</span>
        <span class="p">)</span>

    <span class="c1"># Not all vispy colormaps have an `_controls`</span>
    <span class="c1"># but if they do, we want to use it</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="s1">&#39;_controls&#39;</span><span class="p">):</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">_controls</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Not all vispy colormaps have an `interpolation`</span>
    <span class="c1"># but if they do, we want to use it</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="s1">&#39;interpolation&#39;</span><span class="p">):</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">interpolation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>

    <span class="k">return</span> <span class="n">Colormap</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colormap</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgba</span><span class="p">,</span>
        <span class="n">controls</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_validate_rgb</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the subset of colors that is in [0, 1] for all channels.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    colors : array of float, shape (N, 3)</span>
<span class="sd">        Input colors in RGB space.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    filtered_colors : array of float, shape (M, 3), M &lt;= N</span>
<span class="sd">        The subset of colors that are in valid RGB space.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    tolerance : float, optional</span>
<span class="sd">        Values outside of the range by less than ``tolerance`` are allowed and</span>
<span class="sd">        clipped to be within the range.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; colors = np.array([[  0. , 1.,  1.  ],</span>
<span class="sd">    ...                    [  1.1, 0., -0.03],</span>
<span class="sd">    ...                    [  1.2, 1.,  0.5 ]])</span>
<span class="sd">    &gt;&gt;&gt; _validate_rgb(colors)</span>
<span class="sd">    array([[0., 1., 1.]])</span>
<span class="sd">    &gt;&gt;&gt; _validate_rgb(colors, tolerance=0.15)</span>
<span class="sd">    array([[0., 1., 1.],</span>
<span class="sd">           [1., 0., 0.]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">tolerance</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">tolerance</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">colors</span> <span class="o">&gt;</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">colors</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">filtered_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filtered_colors</span>


<div class="viewcode-block" id="low_discrepancy_image"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.low_discrepancy_image">[docs]</a><span class="k">def</span> <span class="nf">low_discrepancy_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">256</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a 1d low discrepancy sequence of coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image : array of int</span>
<span class="sd">        A set of labels or label image.</span>
<span class="sd">    seed : float</span>
<span class="sd">        The seed from which to start the quasirandom sequence.</span>
<span class="sd">    margin : float</span>
<span class="sd">        Values too close to 0 or 1 will get mapped to the edge of the colormap,</span>
<span class="sd">        so we need to offset to a margin slightly inside those values. Since</span>
<span class="sd">        the bin size is 1/256 by default, we offset by that amount.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    image_out : array of float</span>
<span class="sd">        The set of ``labels`` remapped to [0, 1] quasirandomly.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi_mod</span> <span class="o">=</span> <span class="mf">0.6180339887498948482</span>
    <span class="n">image_float</span> <span class="o">=</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">image</span> <span class="o">*</span> <span class="n">phi_mod</span>
    <span class="c1"># We now map the floats to the range [0 + margin, 1 - margin]</span>
    <span class="n">image_out</span> <span class="o">=</span> <span class="n">margin</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">margin</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">image_float</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">image_float</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">image_out</span></div>


<div class="viewcode-block" id="color_dict_to_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.color_dict_to_colormap">[docs]</a><span class="k">def</span> <span class="nf">color_dict_to_colormap</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a color map based on the given color dictionary</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    colors : dict of int to array of float, shape (4)</span>
<span class="sd">        Mapping between labels and color</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormap : napari.utils.Colormap</span>
<span class="sd">        Colormap constructed with provided control colors</span>
<span class="sd">    label_color_index : dict of int</span>
<span class="sd">        Mapping of Label to color control point within colormap</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">control_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">Colormap</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="n">control_colors</span><span class="p">)</span>
    <span class="n">control2index</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">ctrl</span><span class="p">):</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">control_colors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">control_colors</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">label_color_index</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">control2index</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">)]</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">label_color_index</span></div>


<span class="k">def</span> <span class="nf">_low_discrepancy</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a 1d, 2d, or 3d low discrepancy sequence of coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dim : one of {1, 2, 3}</span>
<span class="sd">        The dimensionality of the sequence.</span>
<span class="sd">    n : int</span>
<span class="sd">        How many points to generate.</span>
<span class="sd">    seed : float or array of float, shape (dim,)</span>
<span class="sd">        The seed from which to start the quasirandom sequence.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pts : array of float, shape (n, dim)</span>
<span class="sd">        The sampled points.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    ..[1]: http://extremelearning.com.au/unreasonable-effectiveness-of-quasirandom-sequences/  # noqa: E501</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi1</span> <span class="o">=</span> <span class="mf">1.6180339887498948482</span>
    <span class="n">phi2</span> <span class="o">=</span> <span class="mf">1.32471795724474602596</span>
    <span class="n">phi3</span> <span class="o">=</span> <span class="mf">1.22074408460575947536</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi1</span><span class="p">,</span> <span class="n">phi2</span><span class="p">,</span> <span class="n">phi3</span><span class="p">])</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">phi</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">(</span><span class="n">seed</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">g</span><span class="p">[:</span><span class="n">dim</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">pts</span>


<span class="k">def</span> <span class="nf">_color_random</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">colorspace</span><span class="o">=</span><span class="s1">&#39;lab&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate n random RGB colors uniformly from LAB or LUV space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int</span>
<span class="sd">        Number of colors to generate.</span>
<span class="sd">    colorspace : str, one of {&#39;lab&#39;, &#39;luv&#39;, &#39;rgb&#39;}</span>
<span class="sd">        The colorspace from which to get random colors.</span>
<span class="sd">    tolerance : float</span>
<span class="sd">        How much margin to allow for out-of-range RGB values (these are</span>
<span class="sd">        clipped to be in-range).</span>
<span class="sd">    seed : float or array of float, shape (3,)</span>
<span class="sd">        Value from which to start the quasirandom sequence.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rgb : array of float, shape (n, 3)</span>
<span class="sd">        RGB colors chosen uniformly at random from given colorspace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># about 1/5 of random LUV tuples are inside the space</span>
    <span class="n">expand_factor</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">random</span> <span class="o">=</span> <span class="n">_low_discrepancy</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorspace</span> <span class="o">==</span> <span class="s1">&#39;luv&#39;</span><span class="p">:</span>
            <span class="n">raw_rgb</span> <span class="o">=</span> <span class="n">colorconv</span><span class="o">.</span><span class="n">luv2rgb</span><span class="p">(</span><span class="n">random</span> <span class="o">*</span> <span class="n">LUVRNG</span> <span class="o">+</span> <span class="n">LUVMIN</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">colorspace</span> <span class="o">==</span> <span class="s1">&#39;rgb&#39;</span><span class="p">:</span>
            <span class="n">raw_rgb</span> <span class="o">=</span> <span class="n">random</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;lab&#39; by default</span>
            <span class="n">raw_rgb</span> <span class="o">=</span> <span class="n">colorconv</span><span class="o">.</span><span class="n">lab2rgb</span><span class="p">(</span><span class="n">random</span> <span class="o">*</span> <span class="n">LABRNG</span> <span class="o">+</span> <span class="n">LABMIN</span><span class="p">)</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">_validate_rgb</span><span class="p">(</span><span class="n">raw_rgb</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">*=</span> <span class="n">expand_factor</span>
    <span class="k">return</span> <span class="n">rgb</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>


<div class="viewcode-block" id="label_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.label_colormap">[docs]</a><span class="k">def</span> <span class="nf">label_colormap</span><span class="p">(</span><span class="n">num_colors</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Produce a colormap suitable for use with a given label set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num_colors : int, optional</span>
<span class="sd">        Number of unique colors to use. Default used if not given.</span>
<span class="sd">    seed : float or array of float, length 3</span>
<span class="sd">        The seed for the random color generator.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormap : napari.utils.Colormap</span>
<span class="sd">        A colormap for use with labels are remapped to [0, 1].</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    0 always maps to fully transparent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Starting the control points slightly above 0 and below 1 is necessary</span>
    <span class="c1"># to ensure that the background pixel 0 is transparent</span>
    <span class="n">midpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="n">num_colors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">control_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">midpoints</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]))</span>
    <span class="c1"># make sure to add an alpha channel to the colors</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="n">_color_random</span><span class="p">(</span><span class="n">num_colors</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">num_colors</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># ensure alpha is 0 for label 0</span>
    <span class="k">return</span> <span class="n">Colormap</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label_colormap&#39;</span><span class="p">,</span>
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">controls</span><span class="o">=</span><span class="n">control_points</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="vispy_or_mpl_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.vispy_or_mpl_colormap">[docs]</a><span class="k">def</span> <span class="nf">vispy_or_mpl_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try to get a colormap from vispy, or convert an mpl one to vispy format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the colormap.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colormap : napari.utils.Colormap</span>
<span class="sd">        The found colormap.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyError</span>
<span class="sd">        If no colormap with that name is found within vispy or matplotlib.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vispy_cmaps</span> <span class="o">=</span> <span class="n">get_colormaps</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vispy_cmaps</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">convert_vispy_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mpl_cmap</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Colormap &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; not found in either vispy &#39;</span>
                <span class="s1">&#39;or matplotlib.&#39;</span>
            <span class="p">)</span>
        <span class="n">mpl_colors</span> <span class="o">=</span> <span class="n">mpl_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">Colormap</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">mpl_colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colormap</span></div>


<span class="c1"># A dictionary mapping names to VisPy colormap objects</span>
<span class="n">ALL_COLORMAPS</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">vispy_or_mpl_colormap</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">matplotlib_colormaps</span><span class="p">}</span>
<span class="n">ALL_COLORMAPS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">SIMPLE_COLORMAPS</span><span class="p">)</span>
<span class="n">ALL_COLORMAPS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">BOP_COLORMAPS</span><span class="p">)</span>

<span class="c1"># ... sorted alphabetically by name</span>
<span class="n">AVAILABLE_COLORMAPS</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ALL_COLORMAPS</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>

<span class="c1"># curated colormap sets</span>
<span class="c1"># these are selected to look good or at least reasonable when using additive</span>
<span class="c1"># blending of multiple channels.</span>
<span class="n">MAGENTA_GREEN</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
<span class="n">RGB</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>
<span class="n">CYMRGB</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="increment_unnamed_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.increment_unnamed_colormap">[docs]</a><span class="k">def</span> <span class="nf">increment_unnamed_colormap</span><span class="p">(</span>
    <span class="n">existing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;[unnamed colormap]&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Increment name for unnamed colormap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    existing : list of str</span>
<span class="sd">        Names of existing colormaps.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        Name of colormap to be incremented. by default &#39;[unnamed colormap]&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of colormap after incrementing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;[unnamed colormap]&#39;</span><span class="p">:</span>
        <span class="n">past_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">existing</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[unnamed colormap&#39;</span><span class="p">)]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[unnamed colormap </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">past_names</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span>
    <span class="k">return</span> <span class="n">name</span></div>


<div class="viewcode-block" id="ensure_colormap"><a class="viewcode-back" href="../../../../api/napari.utils.colormaps.html#napari.utils.colormaps.colormap_utils.ensure_colormap">[docs]</a><span class="k">def</span> <span class="nf">ensure_colormap</span><span class="p">(</span><span class="n">colormap</span><span class="p">:</span> <span class="n">ValidColormapArg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Colormap</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Accept any valid colormap arg, and return (name, Colormap), or raise.</span>

<span class="sd">    Adds any new colormaps to AVAILABLE_COLORMAPS in the process.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    colormap : ValidColormapArg</span>
<span class="sd">        colormap as str, napari.utils.Colormap.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[str, Colormap]</span>
<span class="sd">        Normalized name and napari.utils.Colormap.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    KeyError</span>
<span class="sd">        If a string is provided that is not in AVAILABLE_COLORMAPS</span>
<span class="sd">    TypeError</span>
<span class="sd">        If a tuple is provided and the first element is not a string or the</span>
<span class="sd">        second element is not a Colormap.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If a dict is provided and any of the values are not Colormap instances</span>
<span class="sd">        or valid inputs to the Colormap constructor.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If ``colormap`` is not a ``str``, ``dict``, ``tuple``, or ``Colormap``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">AVAILABLE_COLORMAPS</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">vispy_or_mpl_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># raises KeyError if not found</span>
            <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">):</span>
        <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">colormap</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">):</span>
        <span class="c1"># if a vispy colormap instance is provided, make sure we don&#39;t already</span>
        <span class="c1"># know about it before adding a new unnamed colormap</span>
        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">AVAILABLE_COLORMAPS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">colormap</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">increment_unnamed_colormap</span><span class="p">(</span><span class="n">AVAILABLE_COLORMAPS</span><span class="p">)</span>
        <span class="c1"># Convert from vispy colormap</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">convert_vispy_colormap</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">VispyColormap</span><span class="p">)</span>
                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Colormap</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;When providing a tuple as a colormap argument, the first &quot;</span>
                <span class="s2">&quot;element must be a string and the second a Colormap instance&quot;</span>
            <span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="c1"># Convert from vispy colormap</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">):</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">convert_vispy_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;colors&#39;</span> <span class="ow">in</span> <span class="n">colormap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">],</span> <span class="n">VispyColormap</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">],</span> <span class="n">Colormap</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">Colormap</span><span class="p">(</span><span class="o">**</span><span class="n">colormap</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">name</span>
            <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colormap</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;When providing a dict as a colormap, &quot;</span>
                <span class="s2">&quot;all values must be Colormap instances&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Convert from vispy colormaps</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="n">colormap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Convert from vispy colormap</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">VispyColormap</span><span class="p">):</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">convert_vispy_colormap</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cmap</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">colormap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>
            <span class="n">AVAILABLE_COLORMAPS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colormap</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># first key in dict</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colormap</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="kn">import</span> <span class="nn">warnings</span>

                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;only the first item in a colormap dict is used as an argument&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Received an empty dict as a colormap argument.&quot;</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;invalid type for colormap: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span><span class="si">}</span><span class="s1">. &#39;</span>
            <span class="s1">&#39;Must be a {str, tuple, dict, napari.utils.Colormap, &#39;</span>
            <span class="s1">&#39;vispy.colors.Colormap}&#39;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AVAILABLE_COLORMAPS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, napari contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>