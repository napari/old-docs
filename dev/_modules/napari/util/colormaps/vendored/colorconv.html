

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>napari.util.colormaps.vendored.colorconv &mdash; napari  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> napari
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../napari.html">napari package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">napari</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
      <li>napari.util.colormaps.vendored.colorconv</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for napari.util.colormaps.vendored.colorconv</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions for converting between color spaces.</span>

<span class="sd">The &quot;central&quot; color space in this module is RGB, more specifically the linear</span>
<span class="sd">sRGB color space using D65 as a white-point [1]_.  This represents a</span>
<span class="sd">standard monitor (w/o gamma correction). For a good FAQ on color spaces see</span>
<span class="sd">[2]_.</span>

<span class="sd">The API consists of functions to convert to and from RGB as defined above, as</span>
<span class="sd">well as a generic function to convert to and from any supported color space</span>
<span class="sd">(which is done through RGB in most cases).</span>


<span class="sd">Supported color spaces</span>
<span class="sd">----------------------</span>
<span class="sd">* RGB : Red Green Blue.</span>
<span class="sd">        Here the sRGB standard [1]_.</span>
<span class="sd">* HSV : Hue, Saturation, Value.</span>
<span class="sd">        Uniquely defined when related to sRGB [3]_.</span>
<span class="sd">* RGB CIE : Red Green Blue.</span>
<span class="sd">        The original RGB CIE standard from 1931 [4]_. Primary colors are 700 nm</span>
<span class="sd">        (red), 546.1 nm (blue) and 435.8 nm (green).</span>
<span class="sd">* XYZ CIE : XYZ</span>
<span class="sd">        Derived from the RGB CIE color space. Chosen such that</span>
<span class="sd">        ``x == y == z == 1/3`` at the whitepoint, and all color matching</span>
<span class="sd">        functions are greater than zero everywhere.</span>
<span class="sd">* LAB CIE : Lightness, a, b</span>
<span class="sd">        Colorspace derived from XYZ CIE that is intended to be more</span>
<span class="sd">        perceptually uniform</span>
<span class="sd">* LUV CIE : Lightness, u, v</span>
<span class="sd">        Colorspace derived from XYZ CIE that is intended to be more</span>
<span class="sd">        perceptually uniform</span>
<span class="sd">* LCH CIE : Lightness, Chroma, Hue</span>
<span class="sd">        Defined in terms of LAB CIE.  C and H are the polar representation of</span>
<span class="sd">        a and b.  The polar angle C is defined to be on ``(0, 2*pi)``</span>

<span class="sd">:author: Nicolas Pinto (rgb2hsv)</span>
<span class="sd">:author: Ralf Gommers (hsv2rgb)</span>
<span class="sd">:author: Travis Oliphant (XYZ and RGB CIE functions)</span>
<span class="sd">:author: Matt Terry (lab2lch)</span>
<span class="sd">:author: Alex Izvorski (yuv2rgb, rgb2yuv and related)</span>

<span class="sd">:license: modified BSD</span>

<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">.. [1] Official specification of sRGB, IEC 61966-2-1:1999.</span>
<span class="sd">.. [2] http://www.poynton.com/ColorFAQ.html</span>
<span class="sd">.. [3] https://en.wikipedia.org/wiki/HSL_and_HSV</span>
<span class="sd">.. [4] https://en.wikipedia.org/wiki/CIE_1931_color_space</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">linalg</span>


<div class="viewcode-block" id="guess_spatial_dimensions"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.guess_spatial_dimensions">[docs]</a><span class="k">def</span> <span class="nf">guess_spatial_dimensions</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make an educated guess about whether an image has a channels dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image : ndarray</span>
<span class="sd">        The input image.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    spatial_dims : int or None</span>
<span class="sd">        The number of spatial dimensions of `image`. If ambiguous, the value</span>
<span class="sd">        is ``None``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the image array has less than two or more than four dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected 2D, 3D, or 4D array, got </span><span class="si">%i</span><span class="s2">D.&quot;</span> <span class="o">%</span> <span class="n">image</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_prepare_colorarray</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check the shape of the array and convert it to</span>
<span class="sd">    floating point representation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;the input array must be have a shape == ([ ..,] 3)), &quot;</span> <span class="o">+</span>
               <span class="s2">&quot;got (&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_prepare_rgba_array</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check the shape of the array to be RGBA and convert it to</span>
<span class="sd">    floating point representation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;the input array must have a shape == ([ ..,] 4)), &quot;</span>
               <span class="s2">&quot;got </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>


<div class="viewcode-block" id="rgba2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgba2rgb">[docs]</a><span class="k">def</span> <span class="nf">rgba2rgb</span><span class="p">(</span><span class="n">rgba</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;RGBA to RGB conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgba : array_like</span>
<span class="sd">        The image in RGBA format, in a 3-D array of shape ``(.., .., 4)``.</span>
<span class="sd">    background : array_like</span>
<span class="sd">        The color of the background to blend the image with. A tuple</span>
<span class="sd">        containing 3 floats between 0 to 1 - the RGB value of the background.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgba` is not a 3-D array of shape ``(.., .., 4)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import color</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; img_rgba = data.logo()</span>
<span class="sd">    &gt;&gt;&gt; img_rgb = color.rgba2rgb(img_rgba)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_rgba_array</span><span class="p">(</span><span class="n">rgba</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">background</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;the background must be a tuple with 3 items - the &#39;</span>
                         <span class="s1">&#39;RGB color of the background. Got </span><span class="si">{0}</span><span class="s1"> items.&#39;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">background</span><span class="p">)))</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ichan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ichan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">background</span><span class="p">[</span><span class="n">ichan</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">channels</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ichan</span><span class="p">],</span>
            <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="rgb2hsv"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2hsv">[docs]</a><span class="k">def</span> <span class="nf">rgb2hsv</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to HSV color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : array_like</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in HSV format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Conversion between RGB and HSV color spaces results in some loss of</span>
<span class="sd">    precision, due to integer arithmetic and rounding [1]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/HSL_and_HSV</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import color</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_hsv = color.rgb2hsv(img)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="c1"># -- V channel</span>
    <span class="n">out_v</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># -- S channel</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Ignore warning for zero divided by zero</span>
    <span class="n">old_settings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">out_s</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">out_v</span>
    <span class="n">out_s</span><span class="p">[</span><span class="n">delta</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># -- H channel</span>
    <span class="c1"># red is max</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">out_v</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># green is max</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">out_v</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">+</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># blue is max</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">out_v</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.</span> <span class="o">+</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">out_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">6.</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.</span>
    <span class="n">out_h</span><span class="p">[</span><span class="n">delta</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">old_settings</span><span class="p">)</span>

    <span class="c1"># -- output</span>
    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_h</span>
    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_s</span>
    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_v</span>

    <span class="c1"># remove NaN</span>
    <span class="n">out</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">out</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="hsv2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.hsv2rgb">[docs]</a><span class="k">def</span> <span class="nf">hsv2rgb</span><span class="p">(</span><span class="n">hsv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;HSV to RGB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hsv : array_like</span>
<span class="sd">        The image in HSV format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `hsv` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Conversion between RGB and HSV color spaces results in some loss of</span>
<span class="sd">    precision, due to integer arithmetic and rounding [1]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/HSL_and_HSV</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_hsv = rgb2hsv(img)</span>
<span class="sd">    &gt;&gt;&gt; img_rgb = hsv2rgb(img_hsv)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">hsv</span><span class="p">)</span>

    <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="n">hi</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">hi</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">hi</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">))])</span>

    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># ---------------------------------------------------------------</span>
<span class="c1"># Primaries for the coordinate systems</span>
<span class="c1"># ---------------------------------------------------------------</span>
<span class="n">cie_primaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">700</span><span class="p">,</span> <span class="mf">546.1</span><span class="p">,</span> <span class="mf">435.8</span><span class="p">])</span>
<span class="n">sb_primaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">155</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mi">190</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mi">225</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e5</span>

<span class="c1"># ---------------------------------------------------------------</span>
<span class="c1"># Matrices that define conversion between different color spaces</span>
<span class="c1"># ---------------------------------------------------------------</span>

<span class="c1"># From sRGB specification</span>
<span class="n">xyz_from_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.412453</span><span class="p">,</span> <span class="mf">0.357580</span><span class="p">,</span> <span class="mf">0.180423</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">0.212671</span><span class="p">,</span> <span class="mf">0.715160</span><span class="p">,</span> <span class="mf">0.072169</span><span class="p">],</span>
                         <span class="p">[</span><span class="mf">0.019334</span><span class="p">,</span> <span class="mf">0.119193</span><span class="p">,</span> <span class="mf">0.950227</span><span class="p">]])</span>

<span class="n">rgb_from_xyz</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">xyz_from_rgb</span><span class="p">)</span>

<span class="c1"># From https://en.wikipedia.org/wiki/CIE_1931_color_space</span>
<span class="c1"># Note: Travis&#39;s code did not have the divide by 0.17697</span>
<span class="n">xyz_from_rgbcie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.17697</span><span class="p">,</span> <span class="mf">0.81240</span><span class="p">,</span> <span class="mf">0.01063</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]])</span> <span class="o">/</span> <span class="mf">0.17697</span>

<span class="n">rgbcie_from_xyz</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">xyz_from_rgbcie</span><span class="p">)</span>

<span class="c1"># construct matrices to and from rgb:</span>
<span class="n">rgbcie_from_rgb</span> <span class="o">=</span> <span class="n">rgbcie_from_xyz</span> <span class="o">@</span> <span class="n">xyz_from_rgb</span>
<span class="n">rgb_from_rgbcie</span> <span class="o">=</span> <span class="n">rgb_from_xyz</span> <span class="o">@</span> <span class="n">xyz_from_rgbcie</span>


<span class="n">gray_from_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.2125</span><span class="p">,</span> <span class="mf">0.7154</span><span class="p">,</span> <span class="mf">0.0721</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">yuv_from_rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.299</span>     <span class="p">,</span>  <span class="mf">0.587</span>     <span class="p">,</span>  <span class="mf">0.114</span>      <span class="p">],</span>
                         <span class="p">[</span><span class="o">-</span><span class="mf">0.14714119</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.28886916</span><span class="p">,</span>  <span class="mf">0.43601035</span> <span class="p">],</span>
                         <span class="p">[</span> <span class="mf">0.61497538</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.51496512</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10001026</span> <span class="p">]])</span>

<span class="n">rgb_from_yuv</span> <span class="o">=</span> <span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">yuv_from_rgb</span><span class="p">)</span>


<span class="c1"># CIE LAB constants for Observer=2A, Illuminant=D65</span>
<span class="c1"># NOTE: this is actually the XYZ values for the illuminant above.</span>
<span class="n">lab_ref_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.95047</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.08883</span><span class="p">])</span>

<span class="c1"># XYZ coordinates of the illuminants, scaled to [0, 1]. For each illuminant I</span>
<span class="c1"># we have:</span>
<span class="c1">#</span>
<span class="c1">#   illuminant[I][0] corresponds to the XYZ coordinates for the 2 degree</span>
<span class="c1">#   field of view.</span>
<span class="c1">#</span>
<span class="c1">#   illuminant[I][1] corresponds to the XYZ coordinates for the 10 degree</span>
<span class="c1">#   field of view.</span>
<span class="c1">#</span>
<span class="c1"># The XYZ coordinates are calculated from [1], using the formula:</span>
<span class="c1">#</span>
<span class="c1">#   X = x * ( Y / y )</span>
<span class="c1">#   Y = Y</span>
<span class="c1">#   Z = ( 1 - x - y ) * ( Y / y )</span>
<span class="c1">#</span>
<span class="c1"># where Y = 1. The only exception is the illuminant &quot;D65&quot; with aperture angle</span>
<span class="c1"># 2, whose coordinates are copied from &#39;lab_ref_white&#39; for</span>
<span class="c1"># backward-compatibility reasons.</span>
<span class="c1">#</span>
<span class="c1">#     References</span>
<span class="c1">#    ----------</span>
<span class="c1">#    .. [1] https://en.wikipedia.org/wiki/Standard_illuminant</span>

<span class="n">illuminants</span> <span class="o">=</span> \
    <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.098466069456375</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3558228003436005</span><span class="p">),</span>
           <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.111420406956693</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3519978321919493</span><span class="p">)},</span>
     <span class="s2">&quot;D50&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9642119944211994</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.8251882845188288</span><span class="p">),</span>
             <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9672062750333777</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.8142801513128616</span><span class="p">)},</span>
     <span class="s2">&quot;D55&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.956797052643698</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9214805860173273</span><span class="p">),</span>
             <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9579665682254781</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9092525159847462</span><span class="p">)},</span>
     <span class="s2">&quot;D65&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.95047</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.08883</span><span class="p">),</span>   <span class="c1"># This was: `lab_ref_white`</span>
             <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.94809667673716</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0730513595166162</span><span class="p">)},</span>
     <span class="s2">&quot;D75&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9497220898840717</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.226393520724154</span><span class="p">),</span>
             <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9441713925645873</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.2064272211720228</span><span class="p">)},</span>
     <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
           <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)}}</span>


<div class="viewcode-block" id="get_xyz_coords"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.get_xyz_coords">[docs]</a><span class="k">def</span> <span class="nf">get_xyz_coords</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the XYZ coordinates of the given illuminant and observer [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (x, y, z) : tuple</span>
<span class="sd">        A tuple with 3 elements containing the XYZ coordinates of the given</span>
<span class="sd">        illuminant.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If either the illuminant or the observer angle are not supported or</span>
<span class="sd">        unknown.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/Standard_illuminant</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">illuminant</span> <span class="o">=</span> <span class="n">illuminant</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">illuminants</span><span class="p">[</span><span class="n">illuminant</span><span class="p">][</span><span class="n">observer</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown illuminant/observer combination</span><span class="se">\</span>
<span class="s2">        (</span><span class="se">\&#39;</span><span class="si">{0}</span><span class="se">\&#39;</span><span class="s2">, </span><span class="se">\&#39;</span><span class="si">{1}</span><span class="se">\&#39;</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">))</span></div>

<span class="c1"># -------------------------------------------------------------</span>
<span class="c1"># The conversion functions that make use of the matrices above</span>
<span class="c1"># -------------------------------------------------------------</span>


<span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Do the color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    matrix : array_like</span>
<span class="sd">        The 3x3 matrix to use.</span>
<span class="sd">    arr : array_like</span>
<span class="sd">        The input array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray, dtype=float</span>
<span class="sd">        The converted array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span> <span class="o">@</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


<div class="viewcode-block" id="xyz2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.xyz2rgb">[docs]</a><span class="k">def</span> <span class="nf">xyz2rgb</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;XYZ to RGB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xyz : array_like</span>
<span class="sd">        The image in XYZ format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `xyz` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The CIE XYZ color space is derived from the CIE RGB color space. Note</span>
<span class="sd">    however that this function converts to sRGB.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/CIE_1931_color_space</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2xyz, xyz2rgb</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_xyz = rgb2xyz(img)</span>
<span class="sd">    &gt;&gt;&gt; img_rgb = xyz2rgb(img_xyz)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Follow the algorithm from http://www.easyrgb.com/index.php</span>
    <span class="c1"># except we don&#39;t multiply/divide by 100 in the conversion</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_convert</span><span class="p">(</span><span class="n">rgb_from_xyz</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.055</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.055</span>
    <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">12.92</span>
    <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="rgb2xyz"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2xyz">[docs]</a><span class="k">def</span> <span class="nf">rgb2xyz</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to XYZ color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : array_like</span>
<span class="sd">        The image in RGB format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in XYZ format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb` is not a 3- or 4-D array of shape ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The CIE XYZ color space is derived from the CIE RGB color space. Note</span>
<span class="sd">    however that this function converts from sRGB.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/CIE_1931_color_space</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_xyz = rgb2xyz(img)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Follow the algorithm from http://www.easyrgb.com/index.php</span>
    <span class="c1"># except we don&#39;t multiply/divide by 100 in the conversion</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">&gt;</span> <span class="mf">0.04045</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">12.92</span>
    <span class="k">return</span> <span class="n">_convert</span><span class="p">(</span><span class="n">xyz_from_rgb</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span></div>


<div class="viewcode-block" id="rgb2rgbcie"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2rgbcie">[docs]</a><span class="k">def</span> <span class="nf">rgb2rgbcie</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to RGB CIE color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : array_like</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB CIE format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/CIE_1931_color_space</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2rgbcie</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_rgbcie = rgb2rgbcie(img)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_convert</span><span class="p">(</span><span class="n">rgbcie_from_rgb</span><span class="p">,</span> <span class="n">rgb</span><span class="p">)</span></div>


<div class="viewcode-block" id="rgbcie2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgbcie2rgb">[docs]</a><span class="k">def</span> <span class="nf">rgbcie2rgb</span><span class="p">(</span><span class="n">rgbcie</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB CIE to RGB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgbcie : array_like</span>
<span class="sd">        The image in RGB CIE format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgbcie` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/CIE_1931_color_space</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2rgbcie, rgbcie2rgb</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_rgbcie = rgb2rgbcie(img)</span>
<span class="sd">    &gt;&gt;&gt; img_rgb = rgbcie2rgb(img_rgbcie)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_convert</span><span class="p">(</span><span class="n">rgb_from_rgbcie</span><span class="p">,</span> <span class="n">rgbcie</span><span class="p">)</span></div>


<div class="viewcode-block" id="rgb2gray"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2gray">[docs]</a><span class="k">def</span> <span class="nf">rgb2gray</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute luminance of an RGB image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : array_like</span>
<span class="sd">        The image in RGB format, in a 3-D or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``, or in RGBA format with shape</span>
<span class="sd">        ``(.., ..,[ ..,] 4)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The luminance image - an array which is the same size as the input</span>
<span class="sd">        array, but with the channel dimension removed.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb2gray` is not a 3-D or 4-D arrays of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)`` or ``(.., ..,[ ..,] 4)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.poynton.com/PDFs/ColorFAQ.pdf</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The weights used in this conversion are calibrated for contemporary</span>
<span class="sd">    CRT phosphors::</span>

<span class="sd">        Y = 0.2125 R + 0.7154 G + 0.0721 B</span>

<span class="sd">    If there is an alpha channel present, it is ignored.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2gray</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_gray = rgb2gray(img)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">rgb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>

    <span class="n">rgb</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2125</span><span class="p">,</span> <span class="mf">0.7154</span><span class="p">,</span> <span class="mf">0.0721</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">rgb</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rgb</span> <span class="o">@</span> <span class="n">coeffs</span></div>


<span class="n">rgb2grey</span> <span class="o">=</span> <span class="n">rgb2gray</span>


<div class="viewcode-block" id="xyz2lab"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.xyz2lab">[docs]</a><span class="k">def</span> <span class="nf">xyz2lab</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;XYZ to CIE-LAB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xyz : array_like</span>
<span class="sd">        The image in XYZ format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in CIE-LAB format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `xyz` is not a 3-D array of shape ``(.., ..,[ ..,] 3)``.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If either the illuminant or the observer angle is unsupported or</span>
<span class="sd">        unknown.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    By default Observer= 2A, Illuminant= D65. CIE XYZ tristimulus values</span>
<span class="sd">    x_ref=95.047, y_ref=100., z_ref=108.883. See function `get_xyz_coords` for</span>
<span class="sd">    a list of supported illuminants.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.easyrgb.com/index.php?X=MATH&amp;H=07#text7</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/Lab_color_space</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2xyz, xyz2lab</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_xyz = rgb2xyz(img)</span>
<span class="sd">    &gt;&gt;&gt; img_lab = xyz2lab(img_xyz)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="n">xyz_ref_white</span> <span class="o">=</span> <span class="n">get_xyz_coords</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>

    <span class="c1"># scale by CIE XYZ tristimulus values of the reference white point</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">/</span> <span class="n">xyz_ref_white</span>

    <span class="c1"># Nonlinear distortion and linear transformation</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">&gt;</span> <span class="mf">0.008856</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7.787</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">16.</span> <span class="o">/</span> <span class="mf">116.</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Vector scaling</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="mf">116.</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mf">16.</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">500.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">200.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">L</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="lab2xyz"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.lab2xyz">[docs]</a><span class="k">def</span> <span class="nf">lab2xyz</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CIE-LAB to XYZcolor space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lab : array_like</span>
<span class="sd">        The image in lab format, in a 3-D array of shape ``(.., .., 3)``.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in XYZ format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `lab` is not a 3-D array of shape ``(.., .., 3)``.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If either the illuminant or the observer angle are not supported or</span>
<span class="sd">        unknown.</span>
<span class="sd">    UserWarning</span>
<span class="sd">        If any of the pixels are invalid (Z &lt; 0).</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    By default Observer= 2A, Illuminant= D65. CIE XYZ tristimulus values x_ref</span>
<span class="sd">    = 95.047, y_ref = 100., z_ref = 108.883. See function &#39;get_xyz_coords&#39; for</span>
<span class="sd">    a list of supported illuminants.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.easyrgb.com/index.php?X=MATH&amp;H=07#text7</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/Lab_color_space</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">L</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="mf">16.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">116.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="mf">500.</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="mf">200.</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">out</span> <span class="o">&gt;</span> <span class="mf">0.2068966</span>
    <span class="n">out</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mf">3.</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mf">16.0</span> <span class="o">/</span> <span class="mf">116.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">7.787</span>

    <span class="c1"># rescale to the reference white (illuminant)</span>
    <span class="n">xyz_ref_white</span> <span class="o">=</span> <span class="n">get_xyz_coords</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">*=</span> <span class="n">xyz_ref_white</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="rgb2lab"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2lab">[docs]</a><span class="k">def</span> <span class="nf">rgb2lab</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to lab color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : array_like</span>
<span class="sd">        The image in RGB format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in Lab format, in a 3- or 4-D array of shape</span>
<span class="sd">        ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb` is not a 3- or 4-D array of shape ``(.., ..,[ ..,] 3)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/Standard_illuminant</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function uses rgb2xyz and xyz2lab.</span>
<span class="sd">    By default Observer= 2A, Illuminant= D65. CIE XYZ tristimulus values</span>
<span class="sd">    x_ref=95.047, y_ref=100., z_ref=108.883. See function `get_xyz_coords` for</span>
<span class="sd">    a list of supported illuminants.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xyz2lab</span><span class="p">(</span><span class="n">rgb2xyz</span><span class="p">(</span><span class="n">rgb</span><span class="p">),</span> <span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span></div>


<div class="viewcode-block" id="lab2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.lab2rgb">[docs]</a><span class="k">def</span> <span class="nf">lab2rgb</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lab to RGB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lab : array_like</span>
<span class="sd">        The image in Lab format, in a 3-D array of shape ``(.., .., 3)``.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : ndarray</span>
<span class="sd">        The image in RGB format, in a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `lab` is not a 3-D array of shape ``(.., .., 3)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://en.wikipedia.org/wiki/Standard_illuminant</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function uses lab2xyz and xyz2rgb.</span>
<span class="sd">    By default Observer= 2A, Illuminant= D65. CIE XYZ tristimulus values</span>
<span class="sd">    x_ref=95.047, y_ref=100., z_ref=108.883. See function `get_xyz_coords` for</span>
<span class="sd">    a list of supported illuminants.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xyz2rgb</span><span class="p">(</span><span class="n">lab2xyz</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">))</span></div>


<div class="viewcode-block" id="xyz2luv"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.xyz2luv">[docs]</a><span class="k">def</span> <span class="nf">xyz2luv</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;XYZ to CIE-Luv color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xyz : (M, N, [P,] 3) array_like</span>
<span class="sd">        The 3 or 4 dimensional image in XYZ format. Final dimension denotes</span>
<span class="sd">        channels.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : (M, N, [P,] 3) ndarray</span>
<span class="sd">        The image in CIE-Luv format. Same dimensions as input.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `xyz` is not a 3-D or 4-D array of shape ``(M, N, [P,] 3)``.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If either the illuminant or the observer angle are not supported or</span>
<span class="sd">        unknown.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    By default XYZ conversion weights use observer=2A. Reference whitepoint</span>
<span class="sd">    for D65 Illuminant, with XYZ tristimulus values of ``(95.047, 100.,</span>
<span class="sd">    108.883)``. See function &#39;get_xyz_coords&#39; for a list of supported</span>
<span class="sd">    illuminants.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.easyrgb.com/index.php?X=MATH&amp;H=16#text16</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/CIELUV</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from skimage import data</span>
<span class="sd">    &gt;&gt;&gt; from skimage.color import rgb2xyz, xyz2luv</span>
<span class="sd">    &gt;&gt;&gt; img = data.astronaut()</span>
<span class="sd">    &gt;&gt;&gt; img_xyz = rgb2xyz(img)</span>
<span class="sd">    &gt;&gt;&gt; img_luv = xyz2luv(img_xyz)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="c1"># extract channels</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>

    <span class="c1"># compute y_r and L</span>
    <span class="n">xyz_ref_white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">get_xyz_coords</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">))</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">L</span> <span class="o">&gt;</span> <span class="mf">0.008856</span>
    <span class="n">L</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">116.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">-</span> <span class="mf">16.</span>
    <span class="n">L</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">903.3</span> <span class="o">*</span> <span class="n">L</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>

    <span class="n">u0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">xyz_ref_white</span><span class="p">)</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">xyz_ref_white</span><span class="p">)</span>

    <span class="c1"># u&#39; and v&#39; helper functions</span>
    <span class="k">def</span> <span class="nf">fu</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mf">15.</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">9.</span> <span class="o">*</span> <span class="n">Y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="mf">15.</span> <span class="o">*</span> <span class="n">Y</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>

    <span class="c1"># compute u and v using helper functions</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">13.</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">fu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">u0</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mf">13.</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="p">(</span><span class="n">fv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">v0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">L</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="luv2xyz"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.luv2xyz">[docs]</a><span class="k">def</span> <span class="nf">luv2xyz</span><span class="p">(</span><span class="n">luv</span><span class="p">,</span> <span class="n">illuminant</span><span class="o">=</span><span class="s2">&quot;D65&quot;</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CIE-Luv to XYZ color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    luv : (M, N, [P,] 3) array_like</span>
<span class="sd">        The 3 or 4 dimensional image in CIE-Luv format. Final dimension denotes</span>
<span class="sd">        channels.</span>
<span class="sd">    illuminant : {&quot;A&quot;, &quot;D50&quot;, &quot;D55&quot;, &quot;D65&quot;, &quot;D75&quot;, &quot;E&quot;}, optional</span>
<span class="sd">        The name of the illuminant (the function is NOT case sensitive).</span>
<span class="sd">    observer : {&quot;2&quot;, &quot;10&quot;}, optional</span>
<span class="sd">        The aperture angle of the observer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : (M, N, [P,] 3) ndarray</span>
<span class="sd">        The image in XYZ format. Same dimensions as input.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `luv` is not a 3-D or 4-D array of shape ``(M, N, [P,] 3)``.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If either the illuminant or the observer angle are not supported or</span>
<span class="sd">        unknown.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    XYZ conversion weights use observer=2A. Reference whitepoint for D65</span>
<span class="sd">    Illuminant, with XYZ tristimulus values of ``(95.047, 100., 108.883)``. See</span>
<span class="sd">    function &#39;get_xyz_coords&#39; for a list of supported illuminants.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.easyrgb.com/index.php?X=MATH&amp;H=16#text16</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/CIELUV</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">_prepare_colorarray</span><span class="p">(</span><span class="n">luv</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">L</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>

    <span class="c1"># compute y</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">7.999625</span>
    <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">16.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">116.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">)</span>
    <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="mf">903.3</span>
    <span class="n">xyz_ref_white</span> <span class="o">=</span> <span class="n">get_xyz_coords</span><span class="p">(</span><span class="n">illuminant</span><span class="p">,</span> <span class="n">observer</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">*=</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># reference white x,z</span>
    <span class="n">uv_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">u0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">uv_weights</span> <span class="o">@</span> <span class="n">xyz_ref_white</span><span class="p">)</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">xyz_ref_white</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">uv_weights</span> <span class="o">@</span> <span class="n">xyz_ref_white</span><span class="p">)</span>

    <span class="c1"># compute intermediate values</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">u0</span> <span class="o">+</span> <span class="n">u</span> <span class="o">/</span> <span class="p">(</span><span class="mf">13.</span> <span class="o">*</span> <span class="n">L</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="mf">13.</span> <span class="o">*</span> <span class="n">L</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># compute x and z</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="rgb2luv"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.rgb2luv">[docs]</a><span class="k">def</span> <span class="nf">rgb2luv</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;RGB to CIE-Luv color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgb : (M, N, [P,] 3) array_like</span>
<span class="sd">        The 3 or 4 dimensional image in RGB format. Final dimension denotes</span>
<span class="sd">        channels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : (M, N, [P,] 3) ndarray</span>
<span class="sd">        The image in CIE Luv format. Same dimensions as input.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `rgb` is not a 3-D or 4-D array of shape ``(M, N, [P,] 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function uses rgb2xyz and xyz2luv.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://www.easyrgb.com/index.php?X=MATH&amp;H=16#text16</span>
<span class="sd">    .. [2] http://www.easyrgb.com/index.php?X=MATH&amp;H=02#text2</span>
<span class="sd">    .. [3] https://en.wikipedia.org/wiki/CIELUV</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xyz2luv</span><span class="p">(</span><span class="n">rgb2xyz</span><span class="p">(</span><span class="n">rgb</span><span class="p">))</span></div>


<div class="viewcode-block" id="luv2rgb"><a class="viewcode-back" href="../../../../../napari.util.colormaps.vendored.html#napari.util.colormaps.vendored.colorconv.luv2rgb">[docs]</a><span class="k">def</span> <span class="nf">luv2rgb</span><span class="p">(</span><span class="n">luv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Luv to RGB color space conversion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    luv : (M, N, [P,] 3) array_like</span>
<span class="sd">        The 3 or 4 dimensional image in CIE Luv format. Final dimension denotes</span>
<span class="sd">        channels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : (M, N, [P,] 3) ndarray</span>
<span class="sd">        The image in RGB format. Same dimensions as input.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `luv` is not a 3-D or 4-D array of shape ``(M, N, [P,] 3)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function uses luv2xyz and xyz2rgb.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">xyz2rgb</span><span class="p">(</span><span class="n">luv2xyz</span><span class="p">(</span><span class="n">luv</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Author

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>