Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/jupyter_cache/executors/utils.py", line 51, in single_nb_execution
    executenb(
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/client.py", line 1112, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/util.py", line 74, in wrapped
    return just_run(coro(*args, **kwargs))
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/util.py", line 53, in just_run
    return loop.run_until_complete(coro)
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/asyncio/base_events.py", line 616, in run_until_complete
    return future.result()
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/client.py", line 553, in async_execute
    await self.async_execute_cell(
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/client.py", line 857, in async_execute_cell
    self._check_raise_for_error(cell, exec_reply)
  File "/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/nbclient/client.py", line 760, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
from napari.types import LabelsData, ImageData

@magicgui(call_button='Run Threshold')
def threshold(image: ImageData, threshold: int = 75) -> LabelsData:
    """Threshold an image and return a mask."""
    return (image > threshold).astype(int)

viewer = napari.view_image(np.random.randint(0, 100, (64, 64)))
viewer.window.add_dock_widget(threshold)
threshold()  # "call the widget" to call the function.
             # Normally this would be caused by some user UI interaction
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mValueError[0m                                Traceback (most recent call last)
[0;32m~/work/napari/napari/main/napari/utils/events/containers/_typed.py[0m in [0;36m__getitem__[0;34m(self, key)[0m
[1;32m    144[0m             [0;32mtry[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 145[0;31m                 [0;32mreturn[0m [0mself[0m[0;34m.[0m[0m__getitem__[0m[0;34m([0m[0mself[0m[0;34m.[0m[0mindex[0m[0;34m([0m[0mkey[0m[0;34m)[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    146[0m             [0;32mexcept[0m [0mValueError[0m [0;32mas[0m [0me[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/containers/_typed.py[0m in [0;36mindex[0;34m(self, value, start, stop)[0m
[1;32m    237[0m [0;34m[0m[0m
[0;32m--> 238[0;31m         raise ValueError(
[0m[1;32m    239[0m             trans._(

[0;31mValueError[0m: 'threshold result' is not in list

The above exception was the direct cause of the following exception:

[0;31mKeyError[0m                                  Traceback (most recent call last)
[0;32m~/work/napari/napari/main/napari/utils/_magicgui.py[0m in [0;36madd_layer_data_to_viewer[0;34m(gui, result, return_type)[0m
[1;32m    124[0m         [0;32mtry[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 125[0;31m             [0mviewer[0m[0;34m.[0m[0mlayers[0m[0;34m[[0m[0mgui[0m[0;34m.[0m[0mresult_name[0m[0;34m][0m[0;34m.[0m[0mdata[0m [0;34m=[0m [0mresult[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    126[0m         [0;32mexcept[0m [0mKeyError[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/containers/_typed.py[0m in [0;36m__getitem__[0;34m(self, key)[0m
[1;32m    146[0m             [0;32mexcept[0m [0mValueError[0m [0;32mas[0m [0me[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 147[0;31m                 [0;32mraise[0m [0mKeyError[0m[0;34m([0m[0mstr[0m[0;34m([0m[0me[0m[0;34m)[0m[0;34m)[0m [0;32mfrom[0m [0me[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    148[0m [0;34m[0m[0m

[0;31mKeyError[0m: "'threshold result' is not in list"

During handling of the above exception, another exception occurred:

[0;31mNameError[0m                                 Traceback (most recent call last)
[0;32m<ipython-input-6-80482534c351>[0m in [0;36m<module>[0;34m[0m
[1;32m      8[0m [0mviewer[0m [0;34m=[0m [0mnapari[0m[0;34m.[0m[0mview_image[0m[0;34m([0m[0mnp[0m[0;34m.[0m[0mrandom[0m[0;34m.[0m[0mrandint[0m[0;34m([0m[0;36m0[0m[0;34m,[0m [0;36m100[0m[0;34m,[0m [0;34m([0m[0;36m64[0m[0;34m,[0m [0;36m64[0m[0;34m)[0m[0;34m)[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m      9[0m [0mviewer[0m[0;34m.[0m[0mwindow[0m[0;34m.[0m[0madd_dock_widget[0m[0;34m([0m[0mthreshold[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 10[0;31m [0mthreshold[0m[0;34m([0m[0;34m)[0m  [0;31m# "call the widget" to call the function.[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     11[0m              [0;31m# Normally this would be caused by some user UI interaction[0m[0;34m[0m[0;34m[0m[0;34m[0m[0m

[0;32m/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/site-packages/magicgui/widgets/_function_gui.py[0m in [0;36m__call__[0;34m(self, *args, **kwargs)[0m
[1;32m    295[0m [0;34m[0m[0m
[1;32m    296[0m             [0;32mfor[0m [0mcallback[0m [0;32min[0m [0m_type2callback[0m[0;34m([0m[0mreturn_type[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 297[0;31m                 [0mcallback[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mvalue[0m[0;34m,[0m [0mreturn_type[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    298[0m         [0mself[0m[0;34m.[0m[0mcalled[0m[0;34m([0m[0mvalue[0m[0;34m=[0m[0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    299[0m         [0;32mreturn[0m [0mvalue[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/_magicgui.py[0m in [0;36madd_layer_data_to_viewer[0;34m(gui, result, return_type)[0m
[1;32m    127[0m             [0mlayer_type[0m [0;34m=[0m [0mreturn_type[0m[0;34m.[0m[0m__name__[0m[0;34m.[0m[0mreplace[0m[0;34m([0m[0;34m"Data"[0m[0;34m,[0m [0;34m""[0m[0;34m)[0m[0;34m.[0m[0mlower[0m[0;34m([0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    128[0m             [0madder[0m [0;34m=[0m [0mgetattr[0m[0;34m([0m[0mviewer[0m[0;34m,[0m [0;34mf'add_{layer_type}'[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 129[0;31m             [0madder[0m[0;34m([0m[0mdata[0m[0;34m=[0m[0mresult[0m[0;34m,[0m [0mname[0m[0;34m=[0m[0mgui[0m[0;34m.[0m[0mresult_name[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    130[0m [0;34m[0m[0m
[1;32m    131[0m [0;34m[0m[0m

[0;32m<string>[0m in [0;36madd_labels[0;34m(self, data, num_colors, properties, color, seed, name, metadata, scale, translate, rotate, shear, affine, opacity, blending, visible, multiscale)[0m

[0;32m/opt/hostedtoolcache/Python/3.8.9/x64/lib/python3.8/_collections_abc.py[0m in [0;36mappend[0;34m(self, value)[0m
[1;32m    960[0m     [0;32mdef[0m [0mappend[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mvalue[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m    961[0m         [0;34m'S.append(value) -- append value to the end of the sequence'[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 962[0;31m         [0mself[0m[0;34m.[0m[0minsert[0m[0;34m([0m[0mlen[0m[0;34m([0m[0mself[0m[0;34m)[0m[0;34m,[0m [0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    963[0m [0;34m[0m[0m
[1;32m    964[0m     [0;32mdef[0m [0mclear[0m[0;34m([0m[0mself[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/components/layerlist.py[0m in [0;36minsert[0;34m(self, index, value)[0m
[1;32m     83[0m         [0mnew_layer[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0m_type_check[0m[0;34m([0m[0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m     84[0m         [0mnew_layer[0m[0;34m.[0m[0mname[0m [0;34m=[0m [0mself[0m[0;34m.[0m[0m_coerce_name[0m[0;34m([0m[0mnew_layer[0m[0;34m.[0m[0mname[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 85[0;31m         [0msuper[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0minsert[0m[0;34m([0m[0mindex[0m[0;34m,[0m [0mnew_layer[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     86[0m [0;34m[0m[0m
[1;32m     87[0m         [0;31m# required for deprecated layer.selected property.  remove after 0.4.9[0m[0;34m[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/containers/_selectable_list.py[0m in [0;36minsert[0;34m(self, index, value)[0m
[1;32m     61[0m [0;34m[0m[0m
[1;32m     62[0m     [0;32mdef[0m [0minsert[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mindex[0m[0;34m:[0m [0mint[0m[0;34m,[0m [0mvalue[0m[0;34m:[0m [0m_T[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 63[0;31m         [0msuper[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0minsert[0m[0;34m([0m[0mindex[0m[0;34m,[0m [0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     64[0m         [0;32mif[0m [0mself[0m[0;34m.[0m[0m_activate_on_insert[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m     65[0m             [0;31m# Make layer selected and unselect all others[0m[0;34m[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/containers/_evented_list.py[0m in [0;36minsert[0;34m(self, index, value)[0m
[1;32m    177[0m         [0mself[0m[0;34m.[0m[0mevents[0m[0;34m.[0m[0minserting[0m[0;34m([0m[0mindex[0m[0;34m=[0m[0mindex[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    178[0m         [0msuper[0m[0;34m([0m[0;34m)[0m[0;34m.[0m[0minsert[0m[0;34m([0m[0mindex[0m[0;34m,[0m [0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 179[0;31m         [0mself[0m[0;34m.[0m[0mevents[0m[0;34m.[0m[0minserted[0m[0;34m([0m[0mindex[0m[0;34m=[0m[0mindex[0m[0;34m,[0m [0mvalue[0m[0;34m=[0m[0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    180[0m         [0mself[0m[0;34m.[0m[0m_connect_child_emitters[0m[0;34m([0m[0mvalue[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    181[0m [0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/event.py[0m in [0;36m__call__[0;34m(self, *args, **kwargs)[0m
[1;32m    571[0m                     [0;32mcontinue[0m[0;34m[0m[0;34m[0m[0m
[1;32m    572[0m [0;34m[0m[0m
[0;32m--> 573[0;31m                 [0mself[0m[0;34m.[0m[0m_invoke_callback[0m[0;34m([0m[0mcb[0m[0;34m,[0m [0mevent[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    574[0m                 [0;32mif[0m [0mevent[0m[0;34m.[0m[0mblocked[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m    575[0m                     [0;32mbreak[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/event.py[0m in [0;36m_invoke_callback[0;34m(self, cb, event)[0m
[1;32m    593[0m             [0mcb[0m[0;34m([0m[0mevent[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    594[0m         [0;32mexcept[0m [0mException[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 595[0;31m             _handle_exception(
[0m[1;32m    596[0m                 [0mself[0m[0;34m.[0m[0mignore_callback_errors[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m
[1;32m    597[0m                 [0mself[0m[0;34m.[0m[0mprint_callback_errors[0m[0;34m,[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/utils/events/event.py[0m in [0;36m_invoke_callback[0;34m(self, cb, event)[0m
[1;32m    591[0m     [0;32mdef[0m [0m_invoke_callback[0m[0;34m([0m[0mself[0m[0;34m,[0m [0mcb[0m[0;34m:[0m [0mCallback[0m[0;34m,[0m [0mevent[0m[0;34m:[0m [0mEvent[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m    592[0m         [0;32mtry[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 593[0;31m             [0mcb[0m[0;34m([0m[0mevent[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    594[0m         [0;32mexcept[0m [0mException[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m    595[0m             _handle_exception(

[0;32m~/work/napari/napari/main/napari/_qt/layer_controls/qt_layer_controls_container.py[0m in [0;36m_add[0;34m(self, event)[0m
[1;32m    116[0m         """
[1;32m    117[0m         [0mlayer[0m [0;34m=[0m [0mevent[0m[0;34m.[0m[0mvalue[0m[0;34m[0m[0;34m[0m[0m
[0;32m--> 118[0;31m         [0mcontrols[0m [0;34m=[0m [0mcreate_qt_layer_controls[0m[0;34m([0m[0mlayer[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    119[0m         [0mself[0m[0;34m.[0m[0maddWidget[0m[0;34m([0m[0mcontrols[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    120[0m         [0mself[0m[0;34m.[0m[0mwidgets[0m[0;34m[[0m[0mlayer[0m[0;34m][0m [0;34m=[0m [0mcontrols[0m[0;34m[0m[0;34m[0m[0m

[0;32m~/work/napari/napari/main/napari/_qt/layer_controls/qt_layer_controls_container.py[0m in [0;36mcreate_qt_layer_controls[0;34m(layer)[0m
[1;32m     47[0m     [0;32mfor[0m [0mlayer_type[0m[0;34m,[0m [0mcontrols[0m [0;32min[0m [0mlayer_to_controls[0m[0;34m.[0m[0mitems[0m[0;34m([0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[1;32m     48[0m         [0;32mif[0m [0misinstance[0m[0;34m([0m[0mlayer[0m[0;34m,[0m [0mlayer_type[0m[0;34m)[0m[0;34m:[0m[0;34m[0m[0;34m[0m[0m
[0;32m---> 49[0;31m             [0;32mreturn[0m [0mcontrols[0m[0;34m([0m[0mlayer[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m     50[0m [0;34m[0m[0m
[1;32m     51[0m     raise TypeError(

[0;32m~/work/napari/napari/main/napari/_qt/layer_controls/qt_labels_controls.py[0m in [0;36m__init__[0;34m(self, layer)[0m
[1;32m    113[0m         [0mself[0m[0;34m.[0m[0m_on_contiguous_change[0m[0;34m([0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[1;32m    114[0m [0;34m[0m[0m
[0;32m--> 115[0;31m         [0mndim_sb[0m [0;34m=[0m [0mQSpinBox[0m[0;34m([0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m
[0m[1;32m    116[0m         [0mself[0m[0;34m.[0m[0mndimSpinBox[0m [0;34m=[0m [0mndim_sb[0m[0;34m[0m[0;34m[0m[0m
[1;32m    117[0m         [0mndim_sb[0m[0;34m.[0m[0msetToolTip[0m[0;34m([0m[0mtrans[0m[0;34m.[0m[0m_[0m[0;34m([0m[0;34m'number of dimensions for label editing'[0m[0;34m)[0m[0;34m)[0m[0;34m[0m[0;34m[0m[0m

[0;31mNameError[0m: name 'QSpinBox' is not defined
NameError: name 'QSpinBox' is not defined

